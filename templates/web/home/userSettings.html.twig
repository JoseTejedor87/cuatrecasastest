{% extends 'web/base.html.twig' %}

{% block stylesheets %}
<link href="{{ asset('web/vendor/bootstrap-select/dist/css/bootstrap-select.min.css') }}" rel="stylesheet">
{% endblock %}

{% block main %}

    <main role="main">
        <article class="container">

            <header class="row page__header" style="background-image: url('{{ asset('web/assets/img/la-firma.jpg') }}')">
                <div class="col">
                    <div class="info__block">
                        <h1 class="page__title">
                            {{ 'userForm.title'|trans }}
                        </h1>
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb">
                                <li class="breadcrumb-item">
                                    <a href="{{ path('home') }}">{{ 'global.home'|trans }}</a>
                                </li>
                                <li class="breadcrumb-item active" aria-current="page">
                                    {{ 'userForm.title'|trans }}
                                </li>
                            </ol>
                        </nav>
                    </div>
                    <ul class="action__links">
                        <li><a href="#"><i class="material-icons">share</i></a></li>
                        <li><a href="#"><i class="material-icons">print</i></a></li>
                        <li><a href="#"><i class="material-icons">bookmark_border</i></a></li>
                    </ul>
                </div>
            </header>

            <form action="" class="needs-validation" novalidate>
            {# <form action="" id="userForm" name="userForm" class="needs-validation" novalidate> #}
                <div class="row page__block--full">
                    <div class="col">
                        <h4 class="section__title section__title--main">{{ 'userForm.settings.title'|trans }}</h4>
                        <fieldset>
                            <legend>{{ 'userForm.settings.subTitleInfo'|trans }}</legend>
                            <div class="row">
                                <div class="form-group col-lg-6">
                                    <input type="text" class="form-control" name="eFirstName" id="eFirstName" placeholder="Nombre *" required>
                                </div>
                                <div class="form-group col-lg-6">
                                    <input type="text" class="form-control" name="eLastName" id="eLastName" placeholder="Apellidos *" required>
                                </div>
                                <div class="form-group col-lg-6">
                                    <input type="text" class="form-control" name="eFirstName" id="etel" placeholder="Telefono *" required>
                                </div>
                                <div class="form-group col-lg-6">
                                    <input type="text" class="form-control" name="eEmail" id="eEmail" placeholder="Email *" required>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset>
                            <legend>{{ 'userForm.settings.subTitleCompany'|trans }}</legend>
                            <div class="row">
                                <div class="form-group col-lg-6">
                                    <input type="text" class="form-control" name="ePosition" id="ePosition" placeholder="Cargo *" required>
                                </div>
                                <div class="form-group col-lg-6">
                                    <input type="text" class="form-control" name="eCompany" id="eCompany" placeholder="Empresa *" required>
                                </div>
                            </div>
                        </fieldset>
                        <fieldset>
                            <legend>{{ 'userForm.settings.subTitleContact'|trans }}</legend>
                            <div class="row">
                                <div class="col-lg-6 pr-0 pl-0">
                                    <div class="form-group col-lg-12">
                                        <input type="text" class="form-control" name="eadress" id="eadress" placeholder="Direccion *" required>
                                    </div>
                                    <div class="form-group col-lg-12">
                                        <select name="eCountry" id="eCountry"  class="selectpicker" data-style="btn-custom" data-width="100%" data-size="5" title="País *">
                                            {% if paises|length > 0 %}
                                                {% for value in paises %}
                                                    {% if value['IdPais'] %}
                                                        <option value="{{ value['IdPais'] }}">{{ value['Nombre'] }}</option>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </select>
                                    </div>
                                    <div class="form-group col-lg-12">
                                        <input type="text" class="form-control" name="eTown" id="eTown" placeholder="Población *" required>
                                    </div>
                                    <div class="form-group col-lg-12">
                                        <select id="eRegion" class="form-control custom-select " data-style="btn-custom" data-width="100%" data-size="5" title="Provincia *" required>
                                            <option value="" selected disabled>Provincia *</option>
                                        </select>
                                    </div>
                                    {# <div class="form-group col-lg-12">
                                        <select name="eRegion" id="eRegion" class="selectpicker"  data-width="100%" data-size="5" title="Provincia *" required>
                                            <option value="" selected disabled>Provincia *</option>
                                        </select>
                                    </div> #}
                                </div>
                                <div class="col-lg-6">
                                    <select name="eLang" id="eLang" class="selectpicker form-group" data-style="btn-custom" data-width="100%" data-size="5" title="Idioma de las publicaciones *" required>
                                           {% if idiomas|length > 0 %}
                                                {% for value in idiomas %}
                                                    {% if value['IdIdioma'] %}
                                                        <option value="{{ value['IdIdioma'] }}">{{ value['Nombre'] }}</option>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                    </select>
                                     <div class="form-group">
                                        <input type="text" class="form-control" name="ePostalCode" id="ePostalCode" placeholder="Código postal *" required>
                                    </div>
                                </div>

                            </div>
                        </fieldset>
                    </div>
                </div>

                <div class="row page__block--privacy">
                    <div class="col-12 privacy__text">
                        <h4 class="section__title section__title--main">{{ 'userForm.data.title'|trans }}</h4>
                        <p>
                        <b>Información sobre el tratamiento de sus datos personales</b></p>
                        <p>
                        <b>Responsable del tratamiento:</b> Cuatrecasas Gonçalves Pereira, S.L.P. (“Cuatrecasas”).<br>
                        <b>Finalidades:</b> : gestionar su condición de usuario del sitio web, de las aplicaciones, inscripción a los eventos y su relación con Cuatrecasas, incluyendo el envío de información sobre novedades legales y eventos promovidos por Cuatrecasas. <br>
                        <b>Legitimación:</b> el interés legítimo de Cuatrecasas y, cuando corresponda, el propio consentimiento del usuario. <br>
                        <b>Destinatarios:</b> terceros a los que Cuatrecasas haya encomendado servicios de mailing y de soporte técnico e informático, así como empresas de su mismo grupo. En caso de inscripción a eventos de Cuatrecasas organizados con terceros, sus datos podrán ser cedidos a estos para la organización y gestión de los eventos.<br>
                        <b>Derechos:</b> Acceder, rectificar y suprimir los datos, así como otros derechos, como se explica en la información adicional. Puede consultar la información adicional y detallada sobre protección de datos en <a target="_blank" href="https://www.cuatrecasas.com/media_repository/docs/politica_privacidad.pdf">la política de privacidad</a>.
                        </p>
                    </div>
                    <div class="col-12 privacy__confirm">
                        <div class="form-group">
                            <div class="checkbox">
                                <input name="accept" type="checkbox" id="accept" required>
                                <label  class="checkbox-label" for="accept"><span>He leído y acepto las <a href="#">Condiciones de Uso</a> y la <a href="#">Política de Privacidad</a></span></label>
                            </div>
                        </div>
                        <div class="form-group">
                            <div class="checkbox">
                                <input name="subscribe" type="checkbox" id="subscribe">
                                <label class="checkbox-label" for="subscribe"><span>Deseo recibir información sobre novedades legales y eventos promovidos por Cuatrecasas, incluso por medios electrónicos</span></label>
                            </div>
                        </div>
                        <div class="button__wrapper">
                            <button  class="btn btn__solid btn__solid--icon" id="formSubmit">Guardar <span class="material-icons">save</span></button>
                        </div>
                    </div>
                </div>
            </form>

        </article>
    </main>

{% endblock %}

{% block javascripts %}
<script type="text/javascript" src="{{ asset('web/vendor/bootstrap-select/dist/js/bootstrap-select.min.js') }}"></script>
<script type="text/javascript" src="{{ asset('web/assets/js/responsiveTabs.js') }}"></script>
<script>
    $(function () {
        $('.classictabs__component .nav').responsiveTabs();

        // Bootstrap form validation
        'use strict';
        window.addEventListener('load', function() {
            var forms = document.getElementsByClassName('needs-validation');
            var validation = Array.prototype.filter.call(forms, function(form) {
                form.addEventListener('submit', function(event) {
                    if (form.checkValidity() === false) {
                        event.preventDefault();
                        event.stopPropagation();
                        var errorElements = document.querySelectorAll(".form-control.is-invalid");
                        $('html, body').animate({
                            scrollTop: $(errorElements[0]).offset().top - 120
                        }, 'slow');
                        $(errorElements[0]).focus();
                    }else{
                        form.classList.add('was-validated');
                        event.preventDefault();
                       
                    }
                   
                }, false);
            });
        }, false);

        $("#formSubmit").click( function(e) {
            
            console.log("aa");
            $("#userForm .form-control").removeClass('is-valid');
            $("#userForm .form-control").removeClass('is-invalid');
            var contacto =  validation();
            
            if(contacto){
                e.preventDefault();
                $.ajax({
                    method: "GET",
                    data: { contacto: JSON.stringify(contacto)  },
                    url: "{{ path('set_contact_user') }}",
                    beforeSend: function( xhr ) {
                    }
                    })
                .done(function( data ) {
            
                })
                .fail(function() {
                });
            }
        });
        $("#eCountry").change( function() {
            var idCountry  =  $('#eCountry').val();
            var idCountry  =  $('#eCountry').val();
             $.ajax({
                    method: "GET",
                    data: { idCountry: idCountry  },
                    url: "{{ path('get_regions') }}",
                    beforeSend: function( xhr ) {
                        $('#eRegion option').remove()
                    }
                    })
                .done(function( data ) {
                    var html = '';
                    data.forEach(function(region){
                        html = html + `<option value="`+region['IdProvincia']+`">`+region['Nombre']+`</option>`;
                    })
                    $('#eRegion').append( html  );
                })
                .fail(function() {
                });
        });

        function validation() {
            var contacto =  {};
            var isvalidate = true;
            if($("#eFirstName").val()){
                $("#eFirstName").addClass('is-valid');
                contacto['Nombre']= $("#eFirstName").val();
            }else{
                isvalidate = false;
                $("#eFirstName").addClass('is-invalid');
            }

            if($("#eLastName").val()){
                $("#eLastName").addClass('is-valid');
                contacto['Apellidos']= $("#eLastName").val();
            }else{
                $("#eLastName").addClass('is-invalid');
                isvalidate = false;
            }

            if($("#eEmail").val()){
                $("#eEmail").addClass('is-valid');
                contacto['Email']= $("#eEmail").val();
            }else{
                $("#eEmail").addClass('is-invalid');
                isvalidate = false;
            }

            if($("#ePosition").val()){
                $("#ePosition").addClass('is-valid');
                contacto['Cargo']= $("#ePosition").val();
            }else{
                $("#ePosition").addClass('is-invalid');
                isvalidate = false;
            }

            if($("#eCompany").val()){
                $("#eCompany").addClass('is-valid');
                contacto['Empresa']= $("#eCompany").val();
            }else{
                $("#eCompany").addClass('is-invalid');
                isvalidate = false;
            }

            if($("#eAddress").val()){
                $("#eAddress").addClass('is-valid');
                contacto['Direccion']= $("#eAddress").val();
            }else{
                $("#eAddress").addClass('is-invalid');
                isvalidate = false;
            }

            if($("#ePostalCode").val()){
                $("#ePostalCode").addClass('is-valid');
                contacto['CodigoPostal']= $("#ePostalCode").val();
            }else{
                $("#ePostalCode").addClass('is-invalid');
                isvalidate = false;
            }

            if($("#eCountry").val()){
                $("#eCountry").addClass('is-valid');
                contacto['IdPais']= $("#eCountry").val();
            }else{
                $("#eCountry").addClass('is-invalid');
                isvalidate = false;
            }

            if($("#eRegion").val()){
                $("#eRegion").addClass('is-valid');
                contacto['IdProvincia']= $("#eRegion").val();
            }else{
                $("#eRegion").addClass('is-invalid');
                isvalidate = false;
            }

            if($("#eTel").val()){
                $("#eTel").addClass('is-valid');
                contacto['Telefono']= $("#eTel").val();
            }else{
                $("#eTel").addClass('is-invalid');
                isvalidate = false;
            }

            if($("#accept").is(':checked')){
                contacto['GDPR']= 1;
            }else{
                isvalidate = false;
            }

            if($("#accept").is(':checked')){
                contacto['GDPR']= 1;
            }else{
                isvalidate = false;
            }
            if($("#subscribe").is(':checked')){
                contacto['Suscripcion']= 1;
            }else{
                contacto['Suscripcion']= 0;
            }

            if(isvalidate){
                return contacto;
            }else{
                return isvalidate;
            }
        }
    });
</script>
{% endblock %}
